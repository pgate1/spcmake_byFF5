
       spcmake_byFF5.exe
                                 　　　　      by pgate1

FF5サウンドドライバやFF5波形を使ってSPCを生成します。
MMLはFF5サウンドドライバ向けに特化したものです。

※警告
生成されるSPCにはFF5のサウンドドライバや波形データが含まれています。
SPCデータを容易に公開されることはご遠慮ください。


▼ 使い方

ご自身でFF5カートリッジからFinalFantasy5.romをダンプする。
FinalFantasy5.romをspcmake_byFF5.exeと同じ場所に置く。
必要であれば.brrを用意する。
sample.txt のようなMMLを書く。
spcmake_byFF5.batをダブルクリック。
エラーが無ければsample.spcが生成される。

・コツ

制御コードは16進大文字で 0x 等はつけない。
制御コードはスペースを空ける（実は開けなくてもよい）。
#toneは@の上であればどこで定義しても良い。
ノイズを使用する時はADSR設定のため何かしら波形を指定する必要あり。
「このファイルは"PKCS#7"として使用することはできません」のメッセージは.spcにプレイヤが関連付けられていないため。


▼ 履歴

2020/08/21
#brr_offset指定が無ければ効果音シーケンスを埋め込むよう修正。
効果音のテンポとパンを設定。

2020/08/20
多重ループ内で条件ジャンプ(F9)がちゃんと動作するよう修正。
Gnilda様ご助言ありがとうございました。

2020/08/12
#tone指定を数字のみから文字列も使えるように変更。

2020/08/01
"]3]4"のようなループ記述が失敗する不具合を修正。
（"]3 ]4"のようにスペースがあれば問題なかった）

2020/02/03
引数形式の変更。spcmake_byFF5.exe -i input.txt -o output.spc
brr2wavの追加。

2020/01/19
BRRファイルサイズをチェックするように。ファイルサイズは 9X+2 であること。
FF5inst番号を10進数指定から16進数指定へ変更。
BRRファイル指定時のADSR等も16進指定に変更。

2020/01/18
各トラックのティック数を計算して表示するように。

2020/01/09
FinalFantasy5.romのファイルサイズチェック追加。

2020/01/07
@@nで効果音を鳴らせるように。

2020/01/06
#echo_depthを追加しエコーのかかり具合を指定できるようにした。

2020/01/05
同じBRR波形の場合は多重に埋め込まず、アドレスのみ使いまわすよう修正。

2020/01/04
#macroを追加。

2020/01/03
BRR波形は32個までのチェックを追加。
d(10進数記述)で1バイトにキャストしていなかったものを修正。

2020/01/01
FinalFantasy5.romのみから.spcを生成できるようにした。
ROMアドレスベースをAPUアドレスベースに変更。
逆位相サラウンド #surround 追加。

2019/12/30
曲ループ / を L に変更。
Lの使用で最後に追加するF4に対してのみループアドレスを設定するよう修正。
Lの未使用でF2で終わってない場合はF2を追加するよう修正。
#title を #songname に変更。
#gametitle を追加。
ヘッダにSPC作成年月日を埋め込むように。
#length で再生時間・フェードアウト時間を定義できるように。
! でこれ以降のmmlコンパイルを停止。
FF5instを#toneで宣言する場合にパラメータ指定なしの時はオクターブ・トランスポーズ・ディチューンは自動生成しない。
FF5instを#toneで宣言する場合にパラメータ指定ありの時はオクターブ・トランスポーズ・ディチューンも自動生成する。
F9の条件ジャンプ追加。ループ中に [ XX YY | ZZ ]4 で最後のループ時に抜ける。

2019/12/29
#brr_echo_overcheck 追加、BRR領域がエコー領域と重なるかチェックする。
BRRのスタートアドレス、ループアドレスが0x10000を超えた場合にエラーとなるように。
BRR領域の最後からエコーバッファの前(0xD1FF)まで0クリアする。
#brr_offset auto でシーケンスの直後にBRRを置くようにした。

2019/12/28
#toneでFF5波形を使用する場合は、オクターブ等のパラメータ指定しなくてもいいように修正。
#toneのパラメータ数チェック追加。
#brr_offset で常駐波形もオフセットするように変更。
BRR領域が0x10000を超える場合にエラーとなるように。
BRR領域がエコー領域と重なる場合にエラーとなるように。

2019/12/27
常駐波形の場合はbrrナンバーを割り当てないよう修正（brr番号が32から始まるように）。
使用しないbrrアドレスはゼロ埋めするように修正。

2019/12/26
FF5の常駐波形を使用できるように。
常駐波形を使用する時は#brr_offsetはエラーとなるよう修正。
.batでSPC生成エラーの時はSPC再生しないでエラーメッセージ出したままに。

2019/12/25
FinalFantasy5.romからサウンドドライバ、各音源のBRR・ピッチレート・ADSRを取得して使用。
#toneでトランスポーズ指定やディチューン指定が0の場合はE7、E9を出力しない。
オクターブ操作 > < 追加。

2019/12/22
#toneのパラメータ数が足りない時にエラーとするよう修正。
#comment追加。

2019/12/21
@tone n を @n に変更。
パンの逆転を修正。
#brr_offsetを追加。
#toneでオクターブ・トランスポーズ・ディチューンの設定をできるよう修正。

2019/12/20
初版。


------------------------------------------------------------------------
@brr890様にはサウンドドライバやMML等について多くのアドバイスを頂きました。
心より感謝申し上げます。

SPCプレイヤには黒羽製作所様の黒猫SPCを使用させていただきました。
各レジスタ表示が分かりやすくデバグが捗りました。

SPCのデータ表示や解析にはVGMTransを使用させていただきました。
シーケンスや波形データ位置などの確認がし易かったです。

brr2wavにはごちゃ様のbrr2wav.cppを使用させていただきました。

また次のサイトも参考にさせていただきました。先人の情報共有に感謝します。
・SuperC
　https://github.com/boldowa/SuperC-SPCdrv
・FinalFantasyV 制御コード
　http://gnilda.rosx.net/SPC/F5/command.html
・FF5サウンド関係 ffbin@Wiki
　https://w.atwiki.jp/ffbin/pages/34.html
・FinalFantasy5 HackingWiki
　https://www.ff6hacking.com/ff5wiki/index.php


------------------------------------------------------------------------
pgate1
Web https://pgate1.at-ninja.jp
Twitter https://twitter.com/pgate1
